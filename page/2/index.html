<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">LilyMeng's Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a class="nav-icon" style="width: 46px" href="https://github.com/liyuan-meng" target="_blank">Github</a>
        
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Socket.io/Documentation/1. Introduction" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/30/Socket.io/Documentation/1.%20Introduction/" class="article-date">
  <time datetime="2020-08-30T01:21:37.645Z" itemprop="datePublished">2020-08-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/30/Socket.io/Documentation/1.%20Introduction/">Socket.io/Documentation/1. Introduction</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="What-Socket-IO-is"><a href="#What-Socket-IO-is" class="headerlink" title="What Socket.IO is"></a>What Socket.IO is</h2><p>Socket.IO is a library that enables real-time, bidirectional and event-based communication between the browser and the server. It consists of:</p>
<ul>
<li>a Node.js server: <a href="https://github.com/socketio/socket.io" target="_blank" rel="noopener">Source</a> | <a href="https://socket.io/docs/server-api/" target="_blank" rel="noopener">API</a></li>
<li>a Javascript client library for the browser (which can be also run from Node.js): <a href="https://github.com/socketio/socket.io-client" target="_blank" rel="noopener">Source</a> | <a href="https://socket.io/docs/client-api/" target="_blank" rel="noopener">API</a></li>
</ul>
<p><img src="https://socket.io/images/bidirectional-communication.png" alt="Diagram for bidirectional communication"></p>
<p>There are also several client implementation in other languages, which are maintained by the community:</p>
<ul>
<li>Java: <a href="https://github.com/socketio/socket.io-client-java" target="_blank" rel="noopener">https://github.com/socketio/socket.io-client-java</a></li>
<li>C++: <a href="https://github.com/socketio/socket.io-client-cpp" target="_blank" rel="noopener">https://github.com/socketio/socket.io-client-cpp</a></li>
<li>Swift: <a href="https://github.com/socketio/socket.io-client-swift" target="_blank" rel="noopener">https://github.com/socketio/socket.io-client-swift</a></li>
<li>Dart: <a href="https://github.com/rikulo/socket.io-client-dart" target="_blank" rel="noopener">https://github.com/rikulo/socket.io-client-dart</a></li>
<li>Python: <a href="https://github.com/miguelgrinberg/python-socketio" target="_blank" rel="noopener">https://github.com/miguelgrinberg/python-socketio</a></li>
<li>.Net: <a href="https://github.com/Quobject/SocketIoClientDotNet" target="_blank" rel="noopener">https://github.com/Quobject/SocketIoClientDotNet</a></li>
</ul>
<p>Socket.IO是一个库，可用于在客户端和服务器之间进行实时，双向和基于事件的通信。它包括：</p>
<p>Node.js服务器： API<br>浏览器环境下运行的Javascript客户端（也可以从Node.js运行）： API</p>
<p>还有一些其他语言的客户端实现，由社区维护：</p>
<ul>
<li>Java：https：//github.com/socketio/socket.io-client-java</li>
<li>C ++：https：//github.com/socketio/socket.io-client-cpp</li>
<li>斯威夫特：<a href="https://github.com/socketio/socket.io-client-swift" target="_blank" rel="noopener">https://github.com/socketio/socket.io-client-swift</a></li>
<li>飞镖：https：//github.com/rikulo/socket.io-client-dart</li>
<li>Python：https：//github.com/miguelgrinberg/python-socketio</li>
<li>.Net：https：//github.com/Quobject/SocketIoClientDotNet</li>
</ul>
<h3 id="How-does-that-work"><a href="#How-does-that-work" class="headerlink" title="How does that work?"></a>How does that work?</h3><p>The client will try to establish a <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket" target="_blank" rel="noopener">WebSocket</a> connection if possible, and will fall back on HTTP long polling if not.</p>
<p>WebSocket is a communication protocol which provides a full-duplex and low-latency channel between the server and the browser. More information can be found <a href="https://en.wikipedia.org/wiki/WebSocket" target="_blank" rel="noopener">here</a>.</p>
<p>So, in the best-case scenario, provided that:</p>
<ul>
<li>the browser supports WebSocket (<a href="https://caniuse.com/#search=websocket" target="_blank" rel="noopener">97%</a> of all browsers in 2020)</li>
<li>there is no element (proxy, firewall, …) preventing WebSocket connections between the client and the server</li>
</ul>
<p>you can consider the Socket.IO client as a “slight” wrapper around the WebSocket API. Instead of writing:</p>
<p>如果可能，客户端将尝试建立WebSocket连接，如果没有，客户端将使用HTTP长轮询。</p>
<p>WebSocket是一种通信协议，可在服务器和浏览器之间提供全双工和低延迟通道。更多信息可以在这里找到。</p>
<p>因此，在最佳情况下，应提供：</p>
<ul>
<li><p>浏览器支持WebSocket（2020年所有浏览器中的97％）</p>
</li>
<li><p>没有任何元素（代理，防火墙等）阻止客户端和服务器之间的WebSocket连接</p>
</li>
</ul>
<p>您可以将Socket.IO客户端视为WebSocket API的“轻量”包装器。而不是写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="keyword">new</span> WebSocket(<span class="string">'ws://localhost:3000'</span>);</span><br><span class="line"></span><br><span class="line">socket.onopen(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  socket.send(<span class="string">'Hello!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.onmessage(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>You will have, on the client-side:</p>
<p>在客户端，您将拥有：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = io(<span class="string">'ws://localhost:3000'</span>);</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'connect'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="comment">// either with send()</span></span><br><span class="line">  socket.send(<span class="string">'Hello!'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// or with emit() and custom event names</span></span><br><span class="line">  socket.emit(<span class="string">'salutations'</span>, <span class="string">'Hello!'</span>, &#123; <span class="string">'mr'</span>: <span class="string">'john'</span> &#125;, <span class="built_in">Uint8Array</span>.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// handle the event sent with socket.send()</span></span><br><span class="line">socket.on(<span class="string">'message'</span>, data =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// handle the event sent with socket.emit()</span></span><br><span class="line">socket.on(<span class="string">'greetings'</span>, (elem1, elem2, elem3) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(elem1, elem2, elem3);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The API on the server-side is similar, you also get an <code>socket</code> object which extends the Node.js <a href="https://nodejs.org/docs/latest/api/events.html#events_class_eventemitter" target="_blank" rel="noopener">EventEmitter</a> class:</p>
<p>服务器端的API与此类似，您还获得了一个扩展Node.js EventEmitter类的套接字对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connect'</span>, socket =&gt; &#123;</span><br><span class="line">  <span class="comment">// either with send()</span></span><br><span class="line">  socket.send(<span class="string">'Hello!'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// or with emit() and custom event names</span></span><br><span class="line">  socket.emit(<span class="string">'greetings'</span>, <span class="string">'Hey!'</span>, &#123; <span class="string">'ms'</span>: <span class="string">'jane'</span> &#125;, Buffer.from([<span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handle the event sent with socket.send()</span></span><br><span class="line">  socket.on(<span class="string">'message'</span>, (data) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handle the event sent with socket.emit()</span></span><br><span class="line">  socket.on(<span class="string">'salutations'</span>, (elem1, elem2, elem3) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(elem1, elem2, elem3);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Socket.IO provides additional features over a plain WebSocket object, which are listed <a href="https://socket.io/docs/#Features" target="_blank" rel="noopener">below</a>.</p>
<p>But first, let’s detail what the Socket.IO library is not.</p>
<p>Socket.IO在纯WebSocket对象上提供了其他功能，下面列出了这些功能。</p>
<p>但首先，让我们详细说明Socket.IO库不是什么。</p>
<h2 id="What-Socket-IO-is-not"><a href="#What-Socket-IO-is-not" class="headerlink" title="What Socket.IO is not"></a>What Socket.IO is not</h2><p>Socket.IO is <strong>NOT</strong> a WebSocket implementation. Although Socket.IO indeed uses WebSocket as a transport when possible, it adds additional metadata to each packet. That is why a WebSocket client will not be able to successfully connect to a Socket.IO server, and a Socket.IO client will not be able to connect to a plain WebSocket server either.</p>
<p>Socket.IO不是WebSocket实现。 尽管Socket.IO确实确实在可能的情况下使用WebSocket作为传输方式，但它向每个数据包添加了其他元数据。 这就是为什么WebSocket客户端将无法成功连接到Socket.IO服务器，而Socket.IO客户端也将无法连接到普通WebSocket服务器的原因。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WARNING: the client will NOT be able to connect!</span></span><br><span class="line"><span class="keyword">const</span> socket = io(<span class="string">'ws://echo.websocket.org'</span>);</span><br></pre></td></tr></table></figure>

<p>If you are looking for a plain WebSocket server, please take a look at <a href="https://github.com/websockets/ws" target="_blank" rel="noopener">ws</a> or <a href="https://github.com/uNetworking/uWebSockets.js" target="_blank" rel="noopener">uWebSockets.js</a>.</p>
<p>There are also <a href="https://github.com/nodejs/node/issues/19308" target="_blank" rel="noopener">talks</a> to include a WebSocket server in the Node.js core.</p>
<p>On the client-side, you might be interested by the <a href="https://github.com/nathanboktae/robust-websocket" target="_blank" rel="noopener">robust-websocket</a> package.</p>
<p>如果您正在寻找普通的WebSocket服务器，请查看ws或uWebSockets.js。</p>
<p>也有讨论将WebSocket服务器包含在Node.js核心中。</p>
<p>在客户端，您可能会对robust-websocket软件包感兴趣。</p>
<h2 id="Minimal-working-example"><a href="#Minimal-working-example" class="headerlink" title="Minimal working example"></a>Minimal working example</h2><p>If you are new to the Node.js ecosystem, please take a look at the <a href="https://socket.io/get-started/chat" target="_blank" rel="noopener">Get Started</a> guide, which is ideal for beginners.</p>
<p>Else, let’s start right away! The server library can be installed from NPM:</p>
<p>如果您不熟悉Node.js生态系统，请查看《入门指南》，它是初学者的理想选择。</p>
<p>否则，我们马上开始！ 可以从NPM安装服务器库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install socket.io</span><br></pre></td></tr></table></figure>

<p>More information about the installation can be found in the <a href="https://socket.io/docs/server-installation/" target="_blank" rel="noopener">Server installation</a> page.</p>
<p>Then, let’s create an <code>index.js</code> file, with the following content:</p>
<p>有关安装的更多信息，请参见“服务器安装”页面。</p>
<p>然后，我们创建一个index.js文件，其内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> content = <span class="built_in">require</span>(<span class="string">'fs'</span>).readFileSync(__dirname + <span class="string">'/index.html'</span>, <span class="string">'utf8'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpServer = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// serve the index.html file</span></span><br><span class="line">  res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>);</span><br><span class="line">  res.setHeader(<span class="string">'Content-Length'</span>, Buffer.byteLength(content));</span><br><span class="line">  res.end(content);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(httpServer);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connect'</span>, socket =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'connect'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">httpServer.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'go to http://localhost:3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Here, a classic Node.js <a href="https://nodejs.org/docs/latest/api/http.html#http_class_http_server" target="_blank" rel="noopener">HTTP server</a> is started to serve the <code>index.html</code> file, and the Socket.IO server is attached to it. Please see the <a href="https://socket.io/docs/server-initialization/" target="_blank" rel="noopener">Server initialization</a> page for the various ways to create a server.</p>
<p>Let’s create the <code>index.html</code> file next to it:</p>
<p>在这里，启动了经典的Node.js HTTP服务器来提供index.html文件，并将Socket.IO服务器连接到该服务器。 有关创建服务器的各种方法，请参见服务器初始化页面。</p>
<p>让我们在它旁边创建index.html文件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Minimal working example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"events"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> $events = <span class="built_in">document</span>.getElementById(<span class="string">'events'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> newItem = <span class="function">(<span class="params">content</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> item = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span></span><br><span class="line">          item.innerText = content;</span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> item;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> socket = io();</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        socket.on(<span class="string">'connect'</span>, () =&gt; &#123;</span></span><br><span class="line"><span class="actionscript">          $events.appendChild(newItem(<span class="string">'connect'</span>));</span></span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Finally, let’s start our server:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>

<p>![image-20200830095840462](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200830095840462.png)</p>
<p>The <code>socket</code> object on both sides extends the EventEmitter class, so:</p>
<ul>
<li>sending an event is done with: <code>socket.emit()</code></li>
<li>receiving an event is done by registering a listener: <code>socket.on(, )</code></li>
</ul>
<p>两侧的套接字对象都扩展了EventEmitter类，因此：</p>
<p>发送事件的方法是：socket.emit（）<br>接收事件是通过注册侦听器完成的：socket.on（&lt;事件名称&gt;，&lt;监听器&gt;）</p>
<h3 id="To-send-an-event-from-the-server-to-the-client"><a href="#To-send-an-event-from-the-server-to-the-client" class="headerlink" title="To send an event from the server to the client"></a>To send an event from the server to the client</h3><p>Let’s update the <code>index.js</code> file (server-side):</p>
<p>让我们更新index.js文件（服务器端）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connect'</span>, socket =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> counter = <span class="number">0</span>;</span><br><span class="line">  setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    socket.emit(<span class="string">'hello'</span>, ++counter);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>And the <code>index.html</code> file (client-side):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = io();</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'connect'</span>, () =&gt; &#123;</span><br><span class="line">  $events.appendChild(newItem(<span class="string">'connect'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'hello'</span>, (counter) =&gt; &#123;</span><br><span class="line">  $events.appendChild(newItem(<span class="string">`hello - <span class="subst">$&#123;counter&#125;</span>`</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>![image-20200830100611650](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200830100611650.png)</p>
<h3 id="To-send-a-message-from-the-client-to-the-server"><a href="#To-send-a-message-from-the-client-to-the-server" class="headerlink" title="To send a message from the client to the server"></a>To send a message from the client to the server</h3><p>Let’s update the <code>index.js</code> file (server-side):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connect'</span>, socket =&gt; &#123;</span><br><span class="line">  socket.on(<span class="string">'hey'</span>, data =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'hey'</span>, data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>And the <code>index.html</code> file (client-side):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = io();</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'connect'</span>, () =&gt; &#123;</span><br><span class="line">  $events.appendChild(newItem(<span class="string">'connect'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> counter = <span class="number">0</span>;</span><br><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ++counter;</span><br><span class="line">  socket.emit(<span class="string">'hey'</span>, &#123; counter &#125;); <span class="comment">// the object will be serialized for you</span></span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>![image-20200830101114485](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200830101114485.png)</p>
<p>Now, let’s detail the features provided by Socket.IO.</p>
<p>现在，让我们详细介绍Socket.IO提供的功能。</p>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p>Its main features are:</p>
<h3 id="Reliability（可靠性）"><a href="#Reliability（可靠性）" class="headerlink" title="Reliability（可靠性）"></a>Reliability（可靠性）</h3><p>Connections are established even in the presence of:</p>
<ul>
<li>proxies and load balancers.</li>
<li>personal firewall and antivirus software.</li>
</ul>
<p>For this purpose, it relies on <a href="https://github.com/socketio/engine.io" target="_blank" rel="noopener">Engine.IO</a>, which first establishes a long-polling connection, then tries to upgrade to better transports that are “tested” on the side, like WebSocket. Please see the <a href="https://github.com/socketio/engine.io#goals" target="_blank" rel="noopener">Goals</a> section for more information.</p>
<p>即使存在以下情况也会建立连接：</p>
<ul>
<li>代理和负载均衡。</li>
<li>个人防火墙和防病毒软件。</li>
</ul>
<p>为此，它依赖Engine.IO，该引擎首先建立长轮询连接，然后尝试升级到在侧面进行“测试”的更好传输，例如WebSocket。 请参阅“目标”部分以获取更多信息。</p>
<h3 id="Auto-reconnection-support（自动重新连接支持）"><a href="#Auto-reconnection-support（自动重新连接支持）" class="headerlink" title="Auto-reconnection support（自动重新连接支持）"></a>Auto-reconnection support（自动重新连接支持）</h3><p>Unless instructed otherwise a disconnected client will try to reconnect forever, until the server is available again. Please see the available reconnection options <a href="https://socket.io/docs/client-api/#new-Manager-url-options" target="_blank" rel="noopener">here</a>.</p>
<p>除非另有指示，否则断开连接的客户端将尝试永久重新连接，直到服务器再次可用为止。 请在此处查看可用的重新连接选项。</p>
<h3 id="Disconnection-detection（断线检测）"><a href="#Disconnection-detection（断线检测）" class="headerlink" title="Disconnection detection（断线检测）"></a>Disconnection detection（断线检测）</h3><p>A heartbeat mechanism is implemented at the Engine.IO level, allowing both the server and the client to know when the other one is not responding anymore.</p>
<p>That functionality is achieved with timers set on both the server and the client, with timeout values (the pingInterval and pingTimeout parameters) shared during the connection handshake. Those timers require any subsequent client calls to be directed to the same server, hence the sticky-session requirement when using multiples nodes.</p>
<p>心跳机制在Engine.IO级别上实现，使服务器和客户端都可以知道另一方何时不再响应。</p>
<p>通过在服务器和客户端上设置计时器，并在连接握手期间共享超时值（pingInterval和pingTimeout参数），可以实现该功能。 这些计时器要求将任何后续客户端调用都定向到同一服务器，因此使用多个节点时需要执行粘性会话。</p>
<h3 id="Binary-support（二进制支持）"><a href="#Binary-support（二进制支持）" class="headerlink" title="Binary support（二进制支持）"></a>Binary support（二进制支持）</h3><p>Any serializable data structures can be emitted, including:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener">ArrayBuffer</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" target="_blank" rel="noopener">Blob</a> in the browser</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener">ArrayBuffer</a> and <a href="https://nodejs.org/api/buffer.html" target="_blank" rel="noopener">Buffer</a> in Node.js</li>
</ul>
<p>可以发出任何可序列化的数据结构，包括：</p>
<ul>
<li><p>浏览器中的ArrayBuffer和Blob</p>
</li>
<li><p>Node.js中的ArrayBuffer和Buffer</p>
</li>
</ul>
<h3 id="Multiplexing-support（多路传输支持）"><a href="#Multiplexing-support（多路传输支持）" class="headerlink" title="Multiplexing support（多路传输支持）"></a>Multiplexing support（多路传输支持）</h3><p>In order to create separation of concerns within your application (for example per module, or based on permissions), Socket.IO allows you to create several <a href="https://socket.io/docs/rooms-and-namespaces/#Namespaces" target="_blank" rel="noopener">Namespaces</a>, which will act as separate communication channels but will share the same underlying connection.</p>
<p>为了在应用程序内创建关注点分离（例如，每个模块或基于权限），Socket.IO允许您创建多个命名空间，这些命名空间将充当单独的通信通道，但将共享相同的基础连接。</p>
<p>Caught a mistake? Edit this page on <a href="https://github.com/socketio/socket.io-website/blob/master/source/docs/index.md" target="_blank" rel="noopener">GitHub</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/30/Socket.io/Documentation/1.%20Introduction/" data-id="ckejc3t6p000avcxn60xlgl5p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Socket.io/Introduction" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/08/28/Socket.io/Introduction/" class="article-date">
  <time datetime="2020-08-28T03:22:40.716Z" itemprop="datePublished">2020-08-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/08/28/Socket.io/Introduction/">Socket.io/Introduction</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In this guide we’ll create a basic chat application. It requires almost no basic prior knowledge of Node.JS or Socket.IO, so it’s ideal for users of all knowledge levels.</p>
<p>在本指南中，我们将创建一个基本的聊天应用程序。 它几乎不需要Node.JS或Socket.IO的基础知识，因此非常适合所有知识水平的用户。</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Writing a chat application with popular web applications stacks like LAMP (PHP) has normally been very hard. It involves polling the server for changes, keeping track of timestamps, and it’s a lot slower than it should be.</p>
<p>Sockets have traditionally been the solution around which most real-time chat systems are architected, providing a bi-directional communication channel between a client and a server.</p>
<p>This means that the server can push messages to clients. Whenever you write a chat message, the idea is that the server will get it and push it to all other connected clients.</p>
<p>使用LAMP（PHP）等流行的Web应用程序堆栈编写聊天应用程序通常非常困难。 它涉及轮询服务器的更改，跟踪时间戳，并且比预期的要慢得多。</p>
<p>传统上，套接字是构建大多数实时聊天系统的解决方案，可在客户端和服务器之间提供双向通信通道。</p>
<p>这意味着服务器可以将消息推送到客户端。 每当您编写聊天消息时，其想法都是服务器将获得该消息并将其推送到所有其他已连接的客户端。</p>
<h2 id="The-web-framework"><a href="#The-web-framework" class="headerlink" title="The web framework"></a>The web framework</h2><p>The first goal is to set up a simple HTML webpage that serves out a form and a list of messages. We’re going to use the Node.JS web framework <code>express</code> to this end. Make sure <a href="https://nodejs.org/" target="_blank" rel="noopener">Node.JS</a> is installed.</p>
<p>First let’s create a <code>package.json</code> manifest file that describes our project. I recommend you place it in a dedicated empty directory (I’ll call mine <code>chat-example</code>).</p>
<p>第一个目标是建立一个简单的HTML网页，以提供表单和消息列表。 为此，我们将使用Node.JS网络框架<code>express</code>。 确保已安装[Node.JS]（<a href="https://nodejs.org/）。" target="_blank" rel="noopener">https://nodejs.org/）。</a></p>
<p>首先，我们创建一个描述我们项目的package.json清单文件。 我建议您将其放在专用的空白目录中（我将其称为“聊天示例”）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"socket-chat-example"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"0.0.1"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">"my first socket.io app"</span>,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, in order to easily populate the <code>dependencies</code> property with the things we need, we’ll use <code>npm install</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express@4.15.2</span><br></pre></td></tr></table></figure>

<p>Once it’s installed we can create an <code>index.js</code> file that will set up our application.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(app);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.send(<span class="string">'&lt;h1&gt;Hello world&lt;/h1&gt;'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'listening on *:3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>This means that it:</p>
<ul>
<li>Express initializes <code>app</code> to be a function handler that you can supply to an HTTP server (as seen in line 2).</li>
<li>We define a route handler <code>/</code> that gets called when we hit our website home.</li>
<li>We make the http server listen on port 3000.</li>
</ul>
<p>If you run <code>node index.js</code> you should see the following:</p>
<p>这意味着：</p>
<ul>
<li>Express将<code>app</code>初始化为可以提供给HTTP服务器的函数处理程序（如第2行所示）。</li>
<li>我们定义了一个路由处理程序<code>/</code>，当我们访问我们的网站首页时会调用它。</li>
<li>我们使http服务器在端口3000上侦听。</li>
</ul>
<p>如果运行<code>node index.js</code>，您将看到以下内容：</p>
<p>![image-20200828144327055](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200828144327055.png)</p>
<p>And if you point your browser to <code>http://localhost:3000</code>:</p>
<p>![image-20200828144339554](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200828144339554.png)</p>
<h2 id="Serving-HTML"><a href="#Serving-HTML" class="headerlink" title="Serving HTML"></a>Serving HTML</h2><p>So far in index.js we’re calling res.send and passing it a string of HTML. Our code would look very confusing if we just placed our entire application’s HTML there, so instead we’re going to create a index.html file and serve that instead.</p>
<p>Let’s refactor our route handler to use sendFile instead.</p>
<p>到目前为止，在index.js中，我们正在调用res.send并将其传递为HTML字符串。 如果仅将整个应用程序的HTML放在此处，我们的代码就会看起来很混乱，因此，我们将创建一个index.html文件并将其提供。</p>
<p>让我们重构路由处理程序，改为使用sendFile。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get('/', (req, res) =&gt; &#123;</span><br><span class="line">  res.sendFile(__dirname + '/index.html');</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Put the following in your <code>index.html</code> file:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Socket.IO chat<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">      * &#123; <span class="attribute">margin</span>: <span class="number">0</span>; <span class="attribute">padding</span>: <span class="number">0</span>; <span class="attribute">box-sizing</span>: border-box; &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">body</span> &#123; <span class="attribute">font</span>: <span class="number">13px</span> Helvetica, Arial; &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">form</span> &#123; <span class="attribute">background</span>: <span class="number">#000</span>; <span class="attribute">padding</span>: <span class="number">3px</span>; <span class="attribute">position</span>: fixed; <span class="attribute">bottom</span>: <span class="number">0</span>; <span class="attribute">width</span>: <span class="number">100%</span>; &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">form</span> <span class="selector-tag">input</span> &#123; <span class="attribute">border</span>: <span class="number">0</span>; <span class="attribute">padding</span>: <span class="number">10px</span>; <span class="attribute">width</span>: <span class="number">90%</span>; <span class="attribute">margin-right</span>: <span class="number">0.5%</span>; &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">form</span> <span class="selector-tag">button</span> &#123; <span class="attribute">width</span>: <span class="number">9%</span>; <span class="attribute">background</span>: <span class="built_in">rgb</span>(<span class="number">130</span>, <span class="number">224</span>, <span class="number">255</span>); <span class="attribute">border</span>: none; <span class="attribute">padding</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#messages</span> &#123; <span class="attribute">list-style-type</span>: none; <span class="attribute">margin</span>: <span class="number">0</span>; <span class="attribute">padding</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#messages</span> <span class="selector-tag">li</span> &#123; <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="css">      <span class="selector-id">#messages</span> <span class="selector-tag">li</span><span class="selector-pseudo">:nth-child(odd)</span> &#123; <span class="attribute">background</span>: <span class="number">#eee</span>; &#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"messages"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"m"</span> <span class="attr">autocomplete</span>=<span class="string">"off"</span> /&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>If you restart the process (by hitting Control+C and running <code>node index.js</code> again) and refresh the page it should look like this:</p>
<p>![image-20200828144033697](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200828144033697.png)</p>
<h2 id="Integrating-Socket-IO"><a href="#Integrating-Socket-IO" class="headerlink" title="Integrating Socket.IO"></a>Integrating Socket.IO</h2><p>Socket.IO is composed of two parts:</p>
<ul>
<li>A server that integrates with (or mounts on) the Node.JS HTTP Server <a href="https://github.com/socketio/socket.io" target="_blank" rel="noopener">socket.io</a></li>
<li>A client library that loads on the browser side <a href="https://github.com/socketio/socket.io-client" target="_blank" rel="noopener">socket.io-client</a></li>
</ul>
<p>During development, <code>socket.io</code> serves the client automatically for us, as we’ll see, so for now we only have to install one module:</p>
<p>Socket.IO由两部分组成：</p>
<ul>
<li><p>与Node.JS HTTP Server socket.io集成（或挂载）的服务器</p>
</li>
<li><p>在浏览器端加载的客户端库socket.io-client</p>
</li>
</ul>
<p>如我们所见，在开发过程中，socket.io为我们自动为客户端提供服务，因此，现在我们只需要安装一个模块：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install socket.io</span><br></pre></td></tr></table></figure>

<p>That will install the module and add the dependency to <code>package.json</code>. Now let’s edit <code>index.js</code> to add it:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>).createServer(app);</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(http);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.sendFile(__dirname + <span class="string">'/index.html'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'a user connected'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'listening on *:3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Notice that I initialize a new instance of <code>socket.io</code> by passing the <code>http</code> (the HTTP server) object. Then I listen on the <code>connection</code> event for incoming sockets and log it to the console.</p>
<p>Now in index.html add the following snippet before the `` (end body tag):</p>
<p>请注意，我通过传递http（HTTP服务器）对象来初始化socket.io的新实例。 然后，我侦听传入套接字的连接事件，并将其记录到控制台。</p>
<p>现在在index.html中，在&lt;/ body&gt;（结束body标签）之前添加以下代码段：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">  <span class="keyword">var</span> socket = io();</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>That’s all it takes to load the <code>socket.io-client</code>, which exposes an <code>io</code> global (and the endpoint <code>GET /socket.io/socket.io.js</code>), and then connect.</p>
<p>If you would like to use the local version of the client-side JS file, you can find it at <code>node_modules/socket.io-client/dist/socket.io.js</code>.</p>
<p>Notice that I’m not specifying any URL when I call <code>io()</code>, since it defaults to trying to connect to the host that serves the page.</p>
<p>If you now restart the process (by hitting Control+C and running <code>node index.js</code> again) and then refresh the webpage you should see the console print “a user connected”.</p>
<p>Try opening several tabs, and you’ll see several messages.</p>
<p>这就是加载socket.io-client的全部工作，它公开了一个io全局（和端点GET /socket.io/socket.io.js），然后进行连接。</p>
<p>如果要使用客户端JS文件的本地版本，可以在node_modules / socket.io-client / dist / socket.io.js中找到它。</p>
<p>请注意，我在调用io（）时未指定任何URL，因为它默认为尝试连接到为该页面提供服务的主机。</p>
<p>如果现在重新启动该过程（通过单击Control + C并再次运行节点index.js），然后刷新网页，则应该看到控制台打印“用户已连接”。</p>
<p>尝试打开多个标签，您会看到多则消息。</p>
<p>![image-20200828151113781](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200828151113781.png)</p>
<p>Each socket also fires a special <code>disconnect</code> event:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'a user connected'</span>);</span><br><span class="line">  socket.on(<span class="string">'disconnect'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'user disconnected'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Then if you refresh a tab several times you can see it in action.![image-20200828151141285](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200828151141285.png)</p>
<h2 id="Emitting-events"><a href="#Emitting-events" class="headerlink" title="Emitting events"></a>Emitting events</h2><p>The main idea behind Socket.IO is that you can send and receive any events you want, with any data you want. Any objects that can be encoded as JSON will do, and <a href="https://socket.io/blog/introducing-socket-io-1-0/#binary" target="_blank" rel="noopener">binary data</a> is supported too.</p>
<p>Let’s make it so that when the user types in a message, the server gets it as a <code>chat message</code> event. The <code>script</code> section in <code>index.html</code> should now look as follows:</p>
<p>Socket.IO的主要思想是，您可以使用所需的任何数据发送和接收所需的任何事件。 任何可以被编码为JSON的对象都可以，并且也支持二进制数据。</p>
<p>让我们做到这一点，以便用户输入消息时，服务器将其作为聊天消息事件来获取。 现在，index.html中的脚本部分应如下所示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/socket.io/socket.io.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.4.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> socket = io();</span></span><br><span class="line"><span class="javascript">    $(<span class="string">'form'</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">      e.preventDefault(); <span class="comment">// prevents page reloading</span></span></span><br><span class="line"><span class="javascript">      socket.emit(<span class="string">'chat message'</span>, $(<span class="string">'#m'</span>).val());</span></span><br><span class="line"><span class="javascript">      $(<span class="string">'#m'</span>).val(<span class="string">''</span>);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>And in <code>index.js</code> we print out the <code>chat message</code> event:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</span><br><span class="line">  socket.on(<span class="string">'chat message'</span>, (msg) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'message: '</span> + msg);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The result should be like the following video:</p>
<p><video autoplay="" loop="" width="100%" style="color: rgb(85, 85, 85); font-family: &quot;Open Sans&quot;, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"></video></p>
<h2 id="Broadcasting"><a href="#Broadcasting" class="headerlink" title="Broadcasting"></a>Broadcasting</h2><p>The next goal is for us to emit the event from the server to the rest of the users.</p>
<p>In order to send an event to everyone, Socket.IO gives us the <code>io.emit()</code> method.</p>
<p>我们的下一个目标是将事件从服务器发送给其他用户。</p>
<p>为了向所有人发送事件，Socket.IO提供了io.emit（）方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">io.emit(<span class="string">'some event'</span>, &#123; <span class="attr">someProperty</span>: <span class="string">'some value'</span>, <span class="attr">otherProperty</span>: <span class="string">'other value'</span> &#125;); <span class="comment">// This will emit the event to all connected socket</span></span><br></pre></td></tr></table></figure>

<p>If you want to send a message to everyone except for a certain emitting socket, we have the <code>broadcast</code> flag for emitting from that socket:</p>
<p>如果您想向除某个发射套接字之外的所有人发送消息，我们具有从该套接字发射的广播标志：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</span><br><span class="line">  socket.broadcast.emit(<span class="string">'hi'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>In this case, for the sake of simplicity we’ll send the message to everyone, including the sender.</p>
<p>在这种情况下，为简单起见，我们会将邮件发送给所有人，包括发件人。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">io.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</span><br><span class="line">  socket.on(<span class="string">'chat message'</span>, (msg) =&gt; &#123;</span><br><span class="line">    io.emit(<span class="string">'chat message'</span>, msg);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>And on the client side when we capture a <code>chat message</code> event we’ll include it in the page. The <em>total</em> client-side JavaScript code now amounts to:</p>
<p>在客户端，当我们捕获聊天消息事件时，会将其包括在页面中。 客户端JavaScript代码总数现在达到：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> socket = io();</span></span><br><span class="line"><span class="javascript">    $(<span class="string">'form'</span>).submit(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">      e.preventDefault(); <span class="comment">// prevents page reloading</span></span></span><br><span class="line"><span class="javascript">      socket.emit(<span class="string">'chat message'</span>, $(<span class="string">'#m'</span>).val());</span></span><br><span class="line"><span class="javascript">      $(<span class="string">'#m'</span>).val(<span class="string">''</span>);</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="actionscript">    socket.on(<span class="string">'chat message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(msg)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">      $(<span class="string">'#messages'</span>).append($(<span class="string">'&lt;li&gt;'</span>).text(msg));</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>And that completes our chat application, in about 20 lines of code! This is what it looks like:</p>
<p><video autoplay="" loop="" width="100%"></video></p>
<h2 id="Homework"><a href="#Homework" class="headerlink" title="Homework"></a>Homework</h2><p>Here are some ideas to improve the application:</p>
<ul>
<li>Broadcast a message to connected users when someone connects or disconnects.</li>
<li>Add support for nicknames.</li>
<li>Don’t send the same message to the user that sent it. Instead, append the message directly as soon as he/she presses enter.</li>
<li>Add “{user} is typing” functionality.</li>
<li>Show who’s online.</li>
<li>Add private messaging.</li>
<li>Share your improvements!</li>
</ul>
<p>以下是一些改进应用程序的想法：</p>
<ul>
<li>当有人连接或断开连接时，向连接的用户广播消息。</li>
<li>添加对昵称的支持。</li>
<li>不要将相同的消息发送给发送该消息的用户。 而是，只要他/她按下Enter键，就直接添加消息。</li>
<li>显示谁在线。</li>
<li>添加私人消息。</li>
<li>分享您的改进！</li>
</ul>
<h2 id="Getting-this-example"><a href="#Getting-this-example" class="headerlink" title="Getting this example"></a>Getting this example</h2><p>You can find it on GitHub <a href="https://github.com/socketio/chat-example" target="_blank" rel="noopener">here</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;socketio&#x2F;chat-example.git</span><br></pre></td></tr></table></figure>

<p>Caught a mistake? Edit this page on <a href="https://github.com/socketio/socket.io-website/blob/master/source/get-started/chat.md" target="_blank" rel="noopener">GitHub</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/08/28/Socket.io/Introduction/" data-id="ckejc3t6h0000vcxn6goc8hsq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-解决-React-中的-input-输入框在中文输入法下的-bug" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/14/%E8%A7%A3%E5%86%B3-React-%E4%B8%AD%E7%9A%84-input-%E8%BE%93%E5%85%A5%E6%A1%86%E5%9C%A8%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95%E4%B8%8B%E7%9A%84-bug/" class="article-date">
  <time datetime="2020-06-14T15:09:03.000Z" itemprop="datePublished">2020-06-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/14/%E8%A7%A3%E5%86%B3-React-%E4%B8%AD%E7%9A%84-input-%E8%BE%93%E5%85%A5%E6%A1%86%E5%9C%A8%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95%E4%B8%8B%E7%9A%84-bug/">解决 React 中的 input 输入框在中文输入法下的 bug</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>以下会涉及到的技术点：react mobx compositionstart compositionupdate compositionend</p>
<h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在使用 input 时，通常会对输入的内容做校验，校验的方式无非两种：</p>
<ol>
<li>允许用户输入，并且做错误提示；</li>
<li>不允许用户输入正则或者函数匹配到的字符。</li>
</ol>
<p>现有如下需求：“仅允许输入英文、数字和汉字，不允许输入其他特殊字符和符号”。显然这种场景需要使用第二种校验方式。</p>
<p>然后我自以为很机智的写了下面的代码（引入了组件库 cloud-react），在输入值变化的时候（onChange 事件），处理绑定到 input 上的 value，将除了英文、数字、和汉字之外的字符都替换成空字符串。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">CompositionDemo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">     <span class="keyword">this</span>.state = &#123;</span><br><span class="line">       value: <span class="string">''</span></span><br><span class="line">     &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  onChange(evt) &#123;</span><br><span class="line">     <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">       value: evt.target.value.replace(<span class="regexp">/[^a-zA-Z0-9\u4E00-\u9FA5]/g</span>, <span class="string">''</span>)</span><br><span class="line">     &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Input</span></span></span></span><br><span class="line"><span class="xml">        onChange=&#123;this.onChange.bind(this)&#125;</span></span><br><span class="line"><span class="xml">      	value=&#123;this.state.value&#125;</span></span><br><span class="line"><span class="xml">   	/&gt;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>平平常常，普普通通，一切看起来都是正常的操作，结果，当我输入拼音的时候，神奇的事情发生了：连拼的时候除了最后一个字，前面的都变成了字符。</p>
<p>what??? 小问号，你是否有很多朋友？</p>
<p>于是，我踏上了一条不归路，呸呸呸，是打开了新世界的大门，就是这个门对于我来说可能有点沉，推了两天才看到新世界。</p>
<p>纠其原因：拼音输入是一个过程，确切的说，在这个过程中，你输入的每一个字母都触发了 onChange 事件，而你输入过程中的这个产物在校验中被吃掉了，留下了一坨空字符串，所以就发生了上面那个神奇的现象。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>这里需要用到两个属性：</p>
<p> <a href="https://developer.mozilla.org/zh-CN/docs/Web/Events/compositionstart" target="_blank" rel="noopener">compositionstart</a></p>
<p> <a href="https://developer.mozilla.org/zh-CN/docs/Web/Events/compositionend" target="_blank" rel="noopener">compositionend</a></p>
<p>简单点来说，就是当你开始使用输入法进行新的输入的时候，会触发 compositionstart ，中间过程其实也有一个函数 compositionupdate，顾名思义，输入更新时会触发它；当结束输入法输入的时候，会触发  compositionend。</p>
<p>下面进入正题：</p>
<p>首先，我们先看一下 Input 组件的一个很正常的实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">InputDemo1</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            value: <span class="string">''</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> getDerivedStateFromProps(&#123; value &#125;, &#123; <span class="attr">value</span>: preValue &#125;) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value !== preValue) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123; value &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    onChange = <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.props.onChange(evt);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="xml">            value=&#123;this.state.value&#125;</span></span><br><span class="line"><span class="xml">            type="text"</span></span><br><span class="line"><span class="xml">            onChange=&#123;this.onChange&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Input 组件有两种应用场景：</p>
<ol>
<li>不受控的输入框：业务方不给组件传入 value，无法控制输入框的值；</li>
<li>受控的输入框：业务方可以通过给组件传入 value，从而可以在外部控制输入框的值。</li>
</ol>
<p>不受控的输入框在我使用过程中并没有什么 bug，此处不做赘述，此处只谈受控的输入框，也就是我们需求（仅允许输入英文、数字和汉字，不允许输入其他特殊字符和符号）中需要使用的场景。</p>
<p>前面提到的 compositionstart 和 compositionend 该出场了：利用这两个属性的特点，在输入拼音的“过程中”不让 input 触发 onChange 事件，自然就不会触发校验，好了，既然有了思路，开始码代码。</p>
<p>我们定义一个变量 isOnComposition 来判断是否在“过程中”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">isOnComposition = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">handleComposition = <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (evt.type === <span class="string">'compositionend'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.isOnComposition = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.isOnComposition = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"> onChange = <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (!<span class="keyword">this</span>.isOnComposition) &#123;</span><br><span class="line">     <span class="keyword">this</span>.props.onChange(evt);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">const</span> commonProps = &#123;</span><br><span class="line">    onChange: <span class="keyword">this</span>.onChange,</span><br><span class="line">    onCompositionStart: <span class="keyword">this</span>.handleComposition,</span><br><span class="line">    onCompositionUpdate: <span class="keyword">this</span>.handleComposition,</span><br><span class="line">    onCompositionEnd: <span class="keyword">this</span>.handleComposition,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="xml">    value=&#123;this.state.value&#125;</span></span><br><span class="line"><span class="xml">    type="text"</span></span><br><span class="line"><span class="xml">  	&#123;...commonProps&#125;</span></span><br><span class="line"><span class="xml">  /&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你以为就这么轻松解决了么？</p>
<p>呵，你想多了！</p>
<p>我仍然使用开篇那个 demo 来测试这个代码，发现事情又神奇了一点呢，这次拼音压根就输不进去了哇～</p>
<p>我查看了下在输入拼音时函数的调用</p>
<p>![image-20200615005541929](/Users/liyuanmeng/Library/Application Support/typora-user-images/image-20200615005541929.png)</p>
<p>是的，宁没有看错，只触发了onCompositionstart 和 onCompositionupdate这两个函数，我起初以为是逻辑被我写扣圈了，想了想原因（其实我想了好久，人略笨，见笑）：</p>
<p>罪魁祸首就是绑定在 input 上的那个 value，输入拼音的过程中，state.value 一直没变，input 中自然不会有任何输入值，没有输入值，也就完成不了输入过程，触发不了 compositionend，一直处于“过程中”。</p>
<p>所以这次不是程序逻辑扣圈，是中断了。</p>
<p>于是我又想如何把中断的程序接起来（对的，垮掉了我们就捡起来，哈），完成这个链条。</p>
<p>我想了好多办法，也在网上看了好多办法，可惜都解决不了我的困境。</p>
<p>各种心酸不堪回首，幸好最后找到了一个办法：其实想想原来代码中用 state.value 去控制 input 值的变化，还是没有把 input 中何时输入值的控制权放在自己手里，“过程中”这个概念也就失去了意义。只要 state.value 还和 input 绑在一起，就是我自己玩我自己的，人家玩人家的。于是，就有了下面让控制权回到我手中的代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component, createRef &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">InputDemo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    inputRef = createRef();</span><br><span class="line"></span><br><span class="line">    isOnComposition = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setInputValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentDidUpdate() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setInputValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setInputValue = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.inputRef.current.value = <span class="keyword">this</span>.props.value || <span class="string">''</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    handleComposition = <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (evt.type === <span class="string">'compositionend'</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.isOnComposition = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.isOnComposition = <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    onChange = <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.isOnComposition) &#123;</span><br><span class="line">            <span class="keyword">this</span>.props.onChange(evt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> commonProps = &#123;</span><br><span class="line">            onChange: <span class="keyword">this</span>.onChange,</span><br><span class="line">            onCompositionStart: <span class="keyword">this</span>.handleComposition,</span><br><span class="line">            onCompositionUpdate: <span class="keyword">this</span>.handleComposition,</span><br><span class="line">            onCompositionEnd: <span class="keyword">this</span>.handleComposition,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="xml">            ref=&#123;this.inputRef&#125;</span></span><br><span class="line"><span class="xml">            type="text"</span></span><br><span class="line"><span class="xml">            &#123;...commonProps&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测了一下，大致上是没问题了。</p>
<p>还要看一下谷歌浏览器和火狐浏览器，果然还有坑：</p>
<ol>
<li>火狐浏览器中的执行顺序：compositionstart compositionend onChange</li>
<li>谷歌浏览器中的执行顺序：compositionstart onChange compositionend</li>
</ol>
<p>最后再做一下兼容处理，修改一下 handleComposition 函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">handleComposition = <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (evt.type === <span class="string">'compositionend'</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.isOnComposition = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 谷歌浏览器：compositionstart onChange compositionend</span></span><br><span class="line">    <span class="comment">// 火狐浏览器：compositionstart compositionend onChange</span></span><br><span class="line">    <span class="keyword">if</span> (navigator.userAgent.indexOf(<span class="string">'Chrome'</span>) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onChange(evt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.isOnComposition = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>因为不管中间执行了那些函数，最后都是需要执行 onChange 事件的，因此加了判断，对谷歌浏览器做了特殊处理（其它浏览器暂时没做考虑和处理）。</p>
<p>完整代码 <a href="https://github.com/liyuan-meng/my-react-app/tree/master/src/inputAndComposition" target="_blank" rel="noopener">https://github.com/liyuan-meng/my-react-app/tree/master/src/inputAndComposition</a></p>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>到此，正文结束了，我还要说两个需要注意的地方，其实也是踩了的坑：</p>
<ol>
<li>如果 Input 组件的实现使用了 React.PureComponent ，在以上需求中会出现的问题：输入特殊字符时，外部通过正则将其 replace 掉了，传入 Input 组件内部的 value 实际上没有任何变化，也不会触发组件 render。这是因为 PureComponent 对 shouldComponentUpdate 函数做了优化，如果发现 props 和 state 上的属性都没有变化，不会重新渲染组件，因此我暂时的处理是：使用 React.Component ，组件实现中对 shouldComponentUpdate 封装。</li>
<li>在外部使用 mobx 的时候，如果使用 observable 监听 value，会出现和上面蕾丝的情况—输入特殊字符时，通过正则将其 replace 掉了，mobx 也发现 value 没有任何变化，就不会触发 render，我暂时的处理是使用 state，虽然我觉得这不是最好的办法，但我目前还想不到其它的处理方式。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/14/%E8%A7%A3%E5%86%B3-React-%E4%B8%AD%E7%9A%84-input-%E8%BE%93%E5%85%A5%E6%A1%86%E5%9C%A8%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95%E4%B8%8B%E7%9A%84-bug/" data-id="ckbfcqczl00028xxn3i2n9cr5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-GridManager-表格常用配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/25/GridManager-%E8%A1%A8%E6%A0%BC%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2020-05-25T08:48:24.000Z" itemprop="datePublished">2020-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/25/GridManager-%E8%A1%A8%E6%A0%BC%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/">GridManager 表格常用配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>GridManager 库地址：<a href="http://gridmanager.lovejavascript.com/index.html" target="_blank" rel="noopener">http://gridmanager.lovejavascript.com/index.html</a></p>
<p>本文旨在说明 GridManager 的使用技巧，如果想了解其配置使用，详见文档说明 <a href="https://gridmanager.lovejavascript.com/api/index.html" target="_blank" rel="noopener">https://gridmanager.lovejavascript.com/api/index.html</a></p>
<h4 id="1-基础使用—动态数据表格"><a href="#1-基础使用—动态数据表格" class="headerlink" title="1. 基础使用—动态数据表格"></a>1. 基础使用—动态数据表格</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">export default class App extends Component &#123;</span><br><span class="line">  resource &#x3D; () &#x3D;&gt;</span><br><span class="line">    fetch(</span><br><span class="line">      &quot;https:&#x2F;&#x2F;www.lovejavascript.com&#x2F;learnLinkManager&#x2F;getLearnLinkList&quot;</span><br><span class="line">    ).then((res) &#x3D;&gt; res.json());</span><br><span class="line"></span><br><span class="line">  columnData &#x3D; [</span><br><span class="line">    &#123;</span><br><span class="line">      key: &quot;name&quot;,</span><br><span class="line">      text: &quot;名称&quot;,</span><br><span class="line">      align: &quot;left&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      key: &quot;info&quot;,</span><br><span class="line">      text: &quot;使用说明&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className&#x3D;&quot;App&quot;&gt;</span><br><span class="line">        &lt;Table</span><br><span class="line">          gridManagerName&#x3D;&quot;test&quot;</span><br><span class="line">          disableLine</span><br><span class="line">          supportAjaxPage</span><br><span class="line">          checkboxConfig&#x3D;&#123;&#123; useRowCheck: true &#125;&#125;</span><br><span class="line">          supportDrag&#x3D;&#123;false&#125;</span><br><span class="line">          supportCheckbox&#x3D;&#123;false&#125;</span><br><span class="line">          ajaxData&#x3D;&#123;this.resource&#125;</span><br><span class="line">          columnData&#x3D;&#123;this.columnData&#125;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>完整代码演示：<a href="https://codesandbox.io/s/optimistic-currying-1bxpj?file=/src/App.js" target="_blank" rel="noopener">https://codesandbox.io/s/optimistic-currying-1bxpj?file=/src/App.js</a></p>
<h4 id="2-静态数据表格（分页、排序、搜索、下载）"><a href="#2-静态数据表格（分页、排序、搜索、下载）" class="headerlink" title="2. 静态数据表格（分页、排序、搜索、下载）"></a>2. 静态数据表格（分页、排序、搜索、下载）</h4><p>使用场景：需要纯前端处理表格数据，这时候，我们往往需要在前端实现分页、排序、搜索和下载等函数的封装。</p>
<p>因为每次刷新表格的时候，都会调用 ajaxData 方法，这个方法会返回表格数据，因此，我们只需要在 ajaxData 方法中调用上述封装好的函数即可达到我们要的效果。</p>
<p>这种写法很像过滤器，每一个方法都是对原数据的一次过滤，最后返回过滤后的数据，下面是每个方法的实现：</p>
<p>原始数据originData</p>
<p> —filter—&gt; searchData(originData): searchedData </p>
<p>—filter—&gt; sortingData(searchedData): sortedData </p>
<p>—filter—&gt; paging(sortedData): pagedData </p>
<p>——&gt;处理后的数据</p>
<h5 id="ajaxData-配置："><a href="#ajaxData-配置：" class="headerlink" title="ajaxData 配置："></a>ajaxData 配置：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ajaxData &#x3D; async (settting, params) &#x3D;&gt; &#123;</span><br><span class="line">    const originData &#x3D; this.store.fetchData();</span><br><span class="line">    const searchedData &#x3D; this.store.searchData(originData, this.state.keywords);</span><br><span class="line">    const sortedData &#x3D; this.store.sortingData(searchedData, params);</span><br><span class="line">    this.csvData &#x3D; sortedData.list;</span><br><span class="line">    return await this.store.pagingData(</span><br><span class="line">      sortedData,</span><br><span class="line">      params.pageNum,</span><br><span class="line">      params.pageSize</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<h5 id="分页："><a href="#分页：" class="headerlink" title="分页："></a>分页：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pagingData(data, pageNum, pageSize) &#123;</span><br><span class="line">    const &#123; list &#125; &#x3D; data;</span><br><span class="line">    return Promise.resolve(&#123;</span><br><span class="line">      pageNum,</span><br><span class="line">      pageSize,</span><br><span class="line">      totals: list.length,</span><br><span class="line">      list: list.slice((pageNum - 1) * pageSize, pageNum * pageSize)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h5 id="排序："><a href="#排序：" class="headerlink" title="排序："></a>排序：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sortingData(data, query) &#123;</span><br><span class="line">    let sortProps &#x3D; &quot;DESC&quot;;</span><br><span class="line">    let sortOrder &#x3D; &quot;&quot;;</span><br><span class="line">    Object.keys(query).forEach((key) &#x3D;&gt; &#123;</span><br><span class="line">      if (query[key] &#x3D;&#x3D;&#x3D; &quot;ASC&quot; || query[key] &#x3D;&#x3D;&#x3D; &quot;DESC&quot;) &#123;</span><br><span class="line">        sortProps &#x3D; key.split(&quot;_&quot;)[1];</span><br><span class="line">        sortOrder &#x3D; query[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    const list &#x3D; this.sort(data.list, sortProps, sortOrder);</span><br><span class="line">    return &#123;</span><br><span class="line">      totals: list.length,</span><br><span class="line">      list</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line">sort(list, sortProps, sortOrder) &#123;</span><br><span class="line">    if (sortOrder &#x3D;&#x3D;&#x3D; &quot;ASC&quot;) &#123;</span><br><span class="line">      return sortBy(list, sortProps);</span><br><span class="line">    &#125;</span><br><span class="line">    if (sortOrder &#x3D;&#x3D;&#x3D; &quot;DESC&quot;) &#123;</span><br><span class="line">      return sortBy(list, sortProps).reverse();</span><br><span class="line">    &#125;</span><br><span class="line">    return list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="搜索关键字："><a href="#搜索关键字：" class="headerlink" title="搜索关键字："></a>搜索关键字：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">searchData(data, keywords) &#123;</span><br><span class="line">  const list &#x3D; data.list.filter(</span><br><span class="line">    (item) &#x3D;&gt; item.name &amp;&amp; item.name.indexOf(keywords) &gt; -1</span><br><span class="line">  );</span><br><span class="line">  return &#123;</span><br><span class="line">    totals: list.length,</span><br><span class="line">    list</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="下载："><a href="#下载：" class="headerlink" title="下载："></a>下载：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">download(list, fileName) &#123;</span><br><span class="line">    if (!fileName) return;</span><br><span class="line"></span><br><span class="line">    const url &#x3D; window.URL.createObjectURL(</span><br><span class="line">      new window.Blob([&#96;\ufeff$&#123;list.join(&quot;\r\n&quot;)&#125;&#96;])</span><br><span class="line">    );</span><br><span class="line">    const link &#x3D; document.createElement(&quot;a&quot;);</span><br><span class="line">    const evt &#x3D; document.createEvent(&quot;MouseEvents&quot;);</span><br><span class="line"></span><br><span class="line">    link.href &#x3D; url;</span><br><span class="line">    link.setAttribute(&quot;download&quot;, fileName);</span><br><span class="line"></span><br><span class="line">    evt.initEvent(&quot;click&quot;);</span><br><span class="line"></span><br><span class="line">    link.dispatchEvent(evt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整代码演示: <a href="https://codesandbox.io/s/beautiful-faraday-jt3i3?file=/src/App.js" target="_blank" rel="noopener">https://codesandbox.io/s/beautiful-faraday-jt3i3?file=/src/App.js</a></p>
<h4 id="3-多选表格（数据回显、设置行选中的唯一key值、禁用行选中、最大选中行的限制）"><a href="#3-多选表格（数据回显、设置行选中的唯一key值、禁用行选中、最大选中行的限制）" class="headerlink" title="3. 多选表格（数据回显、设置行选中的唯一key值、禁用行选中、最大选中行的限制）"></a>3. 多选表格（数据回显、设置行选中的唯一key值、禁用行选中、最大选中行的限制）</h4><h5 id="表格选中数据回显"><a href="#表格选中数据回显" class="headerlink" title="表格选中数据回显"></a>表格选中数据回显</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">getCheckedData() &#123;</span><br><span class="line">  return Table.getCheckedData(this.gridManagerName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setCheckedData(checkedData) &#123;</span><br><span class="line">  Table.setCheckedData(this.gridManagerName, checkedData);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ajaxSuccess() &#123;</span><br><span class="line">  this.setCheckedData(this.state.selected);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="设置行选中的唯一key值："><a href="#设置行选中的唯一key值：" class="headerlink" title="设置行选中的唯一key值："></a>设置行选中的唯一key值：</h5><p>表格方法 getCheckedData 返回的是完整的已选数据，表格回显的前提是传入的数据和传出的数据格式一样，这在使用中会造成局限，比如说后端并不会存储完整的数据，而是只存储每条数据的 id，这是很常见的场景，因此在 GridManager 后面的迭代中，在 checkboxConfig 中添加了 key 属性，只需要配置 key: ‘id’，在传入的已选数据中，每条数据只需要包括 id 即可，不需要完整的数据结构也可以完成回显。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Table</span><br><span class="line">	checkboxConfig: &#123; <span class="attr">useRowCheck</span>: <span class="literal">true</span>, <span class="attr">key</span>: <span class="string">'id'</span> &#125;,</span><br><span class="line"> /&gt;</span><br></pre></td></tr></table></figure>

<h5 id="禁用行选中"><a href="#禁用行选中" class="headerlink" title="禁用行选中"></a>禁用行选中</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">onGridRowRender(row) &#123;</span><br><span class="line">    const disabledId &#x3D; [69, 68];</span><br><span class="line">    if (disabledId.indexOf(row.id) &gt; -1) &#123;</span><br><span class="line">      Object.assign(row, &#123; gm_checkbox_disabled: true &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    return row;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h5 id="最大选中行限制："><a href="#最大选中行限制：" class="headerlink" title="最大选中行限制："></a>最大选中行限制：</h5><p>需要调用 checkedGridBefore 和 checkedGridAllBefore 这两个方法来完成此需求，由于触发 checkedAllBefore 之后也会触发 checkedBefore，因此这里需要特殊处理一下，防止出现两次 error 提示，详细见下面的代码实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">checkedGridBefore &#x3D; (checkedList, isChecked) &#x3D;&gt; &#123;</span><br><span class="line">    if (checkedList.length &gt;&#x3D; MAX_NUM &amp;&amp; !isChecked) &#123;</span><br><span class="line">      Message.error(&quot;最多支持同时选择5个&quot;);</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  checkedGridAllBefore(checkedList, isChecked) &#123;</span><br><span class="line">    const unChecked &#x3D; this.dataList</span><br><span class="line">      .map((item) &#x3D;&gt; !checkedList.find((item1) &#x3D;&gt; item.id &#x3D;&#x3D;&#x3D; item1.id))</span><br><span class="line">      .filter(Boolean);</span><br><span class="line"></span><br><span class="line">    if (unChecked.length + checkedList.length &gt; MAX_NUM &amp;&amp; !isChecked) &#123;</span><br><span class="line">      &#x2F;&#x2F; 触发 checkedAllBefore 之后也会触发 checkedBefore，这里需要特殊处理一下，防止出现两次 error 提示</span><br><span class="line">      if (checkedList.length &lt; MAX_NUM) &#123;</span><br><span class="line">        Message.error(&quot;最多支持同时选择5个&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>完整代码演示：<a href="https://codesandbox.io/s/dazzling-albattani-o7dtn?file=/src/App.js" target="_blank" rel="noopener">https://codesandbox.io/s/dazzling-albattani-o7dtn?file=/src/App.js</a></p>
<h4 id="4-树状表格"><a href="#4-树状表格" class="headerlink" title="4. 树状表格"></a>4. 树状表格</h4><p>在表格基本配置的基础上，添加 supportTreeData = true 以及 treeConfig 即可完成一个树表格的展示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">supportTreeData</span><br><span class="line">treeConfig=&#123;&#123; <span class="attr">treeKey</span>: <span class="string">"children"</span> &#125;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>完整代码演示：<a href="https://codesandbox.io/s/shy-smoke-7ltz2?file=/src/App.js" target="_blank" rel="noopener">https://codesandbox.io/s/shy-smoke-7ltz2?file=/src/App.js</a></p>
<h4 id="5-常用的一些使用优化（firstLoading，-isIconFollowText，拖拽、隐藏列）"><a href="#5-常用的一些使用优化（firstLoading，-isIconFollowText，拖拽、隐藏列）" class="headerlink" title="5. 常用的一些使用优化（firstLoading， isIconFollowText，拖拽、隐藏列）"></a>5. 常用的一些使用优化（firstLoading， isIconFollowText，拖拽、隐藏列）</h4><h5 id="firstLoading："><a href="#firstLoading：" class="headerlink" title="firstLoading："></a>firstLoading：</h5><p>设置 firstLoading = false，可以让表格先渲染出来，然后再加载数据。</p>
<p>使用场景：表格数据的请求返回较慢，这时，设置 firstLoading = false，表格就会先渲染，交互上会更加友好。</p>
<p>注意事项：需要配合 callback 函数使用，在 callback 函数中调用刷新表格的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">reloadGrid(gotoPage) &#123;</span><br><span class="line">    Table.setQuery(this.gridManagerName, this.queryParams, gotoPage);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  gridInit &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    this.reloadGrid(1);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className&#x3D;&quot;App&quot;&gt;</span><br><span class="line">        &lt;Table</span><br><span class="line">          gridManagerName&#x3D;&#123;this.gridManagerName&#125;</span><br><span class="line">          disableLine</span><br><span class="line">          supportAjaxPage</span><br><span class="line">          ajaxData&#x3D;&#123;this.ajaxData&#125;</span><br><span class="line">          columnData&#x3D;&#123;this.columnData&#125;</span><br><span class="line">          supportCheckbox&#x3D;&#123;false&#125;</span><br><span class="line">          firstLoading&#x3D;&#123;false&#125;</span><br><span class="line">          callback&#x3D;&#123;this.gridInit&#125;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>完整代码演示：<a href="https://codesandbox.io/s/quirky-https-k06m9?file=/src/App.js" target="_blank" rel="noopener">https://codesandbox.io/s/quirky-https-k06m9?file=/src/App.js</a></p>
<h5 id="isIconFollowText："><a href="#isIconFollowText：" class="headerlink" title="isIconFollowText："></a>isIconFollowText：</h5><p>可以设置表头的icon图标是否跟随文本，默认图标是在左侧，设置后会跟在文本右侧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">columnData &#x3D; [</span><br><span class="line">    &#123;</span><br><span class="line">      key: &quot;name&quot;,</span><br><span class="line">      text: &quot;名称&quot;,</span><br><span class="line">      align: &quot;left&quot;,</span><br><span class="line">      sorting: &quot;&quot;,</span><br><span class="line">      &#x2F;&#x2F; 表头 tooltip 配置</span><br><span class="line">      remind: &#123;</span><br><span class="line">        text: &quot;字段说明字段说明字段说明字段说明字段说明字段说明&quot;,</span><br><span class="line">        style: &#123;</span><br><span class="line">          &quot;text-align&quot;: &quot;left&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;div className&#x3D;&quot;App&quot;&gt;</span><br><span class="line">        &lt;Table</span><br><span class="line">          gridManagerName&#x3D;&#123;this.gridManagerName&#125;</span><br><span class="line">          disableLine</span><br><span class="line">          supportAjaxPage</span><br><span class="line">          ajaxData&#x3D;&#123;this.ajaxData&#125;</span><br><span class="line">          columnData&#x3D;&#123;this.columnData&#125;</span><br><span class="line">          supportCheckbox&#x3D;&#123;false&#125;</span><br><span class="line">          isIconFollowText</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>完整代码演示：<a href="https://codesandbox.io/s/interesting-dust-wwe85?file=/src/App.js:574-1194" target="_blank" rel="noopener">https://codesandbox.io/s/interesting-dust-wwe85?file=/src/App.js:574-1194</a></p>
<h5 id="拖拽："><a href="#拖拽：" class="headerlink" title="拖拽："></a>拖拽：</h5><p>在拖拽的场景中，如果涉及到表格的新增和删除，不要直接对 ajaxData 进行操作，操作原数据，ajaxData 由原数据包装而来，从而保证单一职责（详细栗子请看完整代码）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"> ajaxData &#x3D; async (settting, params) &#x3D;&gt; &#123;</span><br><span class="line">   return Promise.resolve(&#123;</span><br><span class="line">     data: this.state.dataList, &#x2F;&#x2F; dataList：原数据</span><br><span class="line">     totals: this.state.dataList.length</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">onAdd() &#123;</span><br><span class="line">   const &#123; dataList &#125; &#x3D; this.state; &#x2F;&#x2F; dataList：原数据</span><br><span class="line">   dataList.push(&#123;</span><br><span class="line">     id: new Date().getTime(),</span><br><span class="line">     name: &quot;浏览器的工作原理&quot;</span><br><span class="line">   &#125;);</span><br><span class="line">   this.setState(&#123; dataList &#125;);</span><br><span class="line">   this.reloadGrid();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> render() &#123;</span><br><span class="line">   const moveRowConfig &#x3D; &#123;</span><br><span class="line">     key: &quot;priority&quot;,</span><br><span class="line">     handler: (list, tableData) &#x3D;&gt; &#123;</span><br><span class="line">       console.log(tableData);</span><br><span class="line">     &#125;,</span><br><span class="line">     useSingleMode: true &#x2F;&#x2F; 第一列显示拖拽图标</span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   return (</span><br><span class="line">     &lt;div className&#x3D;&quot;App&quot;&gt;</span><br><span class="line">       &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; this.onAdd()&#125;&gt;新增&lt;&#x2F;Button&gt;</span><br><span class="line">       &lt;Table</span><br><span class="line">         gridManagerName&#x3D;&#123;this.gridManagerName&#125;</span><br><span class="line">         disableLine</span><br><span class="line">         supportAjaxPage&#x3D;&#123;false&#125;</span><br><span class="line">         ajaxData&#x3D;&#123;this.ajaxData&#125;</span><br><span class="line">         columnData&#x3D;&#123;this.columnData&#125;</span><br><span class="line">         supportCheckbox&#x3D;&#123;false&#125;</span><br><span class="line">         supportMoveRow</span><br><span class="line">         moveRowConfig&#x3D;&#123;moveRowConfig&#125;</span><br><span class="line">       &#x2F;&gt;</span><br><span class="line">     &lt;&#x2F;div&gt;</span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>完整代码演示：<a href="https://codesandbox.io/s/jovial-water-8y4if?file=/src/App.js" target="_blank" rel="noopener">https://codesandbox.io/s/jovial-water-8y4if?file=/src/App.js</a></p>
<h5 id="隐藏列"><a href="#隐藏列" class="headerlink" title="隐藏列"></a>隐藏列</h5><p>使用场景：需要展示的列比较多或者有隐藏列的需求。</p>
<p>使用：在 columnData 数组新增一项配置即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">    key: <span class="string">"operate"</span>,</span><br><span class="line">    disableCustomize: <span class="literal">true</span>,</span><br><span class="line">    text: (</span><br><span class="line">      &lt;Icon</span><br><span class="line">        type=<span class="string">"config"</span></span><br><span class="line">        style=&#123;&#123; <span class="attr">cursor</span>: <span class="string">"pointer"</span>, <span class="attr">fontWeight</span>: <span class="string">"bold"</span> &#125;&#125;</span><br><span class="line">        onClick=&#123;() =&gt; <span class="keyword">this</span>.onSetUpGridFiled()&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    ),</span><br><span class="line">    template: <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">""</span>,</span><br><span class="line">    width: <span class="string">"30px"</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">onSetUpGridFiled() &#123;</span><br><span class="line">  Table.setConfigVisible(<span class="keyword">this</span>.gridManagerName, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整代码演示：<a href="https://codesandbox.io/s/sharp-perlman-1elht?file=/src/App.js:1094-1174" target="_blank" rel="noopener">https://codesandbox.io/s/sharp-perlman-1elht?file=/src/App.js:1094-1174</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/25/GridManager-%E8%A1%A8%E6%A0%BC%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/" data-id="ckbfcqczk00018xxn4e7cafac" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GridManager/" rel="tag">GridManager</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-安装-Linux-版本为知笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/25/%E5%AE%89%E8%A3%85-Linux-%E7%89%88%E6%9C%AC%E4%B8%BA%E7%9F%A5%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-05-25T07:46:37.000Z" itemprop="datePublished">2020-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/25/%E5%AE%89%E8%A3%85-Linux-%E7%89%88%E6%9C%AC%E4%B8%BA%E7%9F%A5%E7%AC%94%E8%AE%B0/">安装 Linux 版本为知笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="官网安装方式"><a href="#官网安装方式" class="headerlink" title="官网安装方式"></a>官网安装方式</h3><ul>
<li>下载 <a href="http://www.wiz.cn/wiznote-linux.html" target="_blank" rel="noopener">http://www.wiz.cn/wiznote-linux.html</a></li>
<li>Ubuntu 18.04 下运行前，请先执行 sudo apt install openssl1.0 libssl1.0-dev ，再双击运行绿色版</li>
<li>推荐使用 ibus 输入法</li>
</ul>
<h3 id="下载-deb-文件进行安装"><a href="#下载-deb-文件进行安装" class="headerlink" title="下载 .deb 文件进行安装"></a>下载 .deb 文件进行安装</h3><ul>
<li>安装包下载 <a href="https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages" target="_blank" rel="noopener">https://launchpad.net/~wiznote-team/+archive/ubuntu/ppa/+packages</a></li>
<li>双击下载的 .deb 文件进行安装</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/25/%E5%AE%89%E8%A3%85-Linux-%E7%89%88%E6%9C%AC%E4%B8%BA%E7%9F%A5%E7%AC%94%E8%AE%B0/" data-id="ckam6t4900005v8xn8nih9j4g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux-%E4%B8%BA%E7%9F%A5%E7%AC%94%E8%AE%B0/" rel="tag">Linux 为知笔记</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-使用Hexo-Github搭建博客" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/05/25/%E4%BD%BF%E7%94%A8Hexo-Github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" class="article-date">
  <time datetime="2020-05-25T07:29:59.000Z" itemprop="datePublished">2020-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/05/25/%E4%BD%BF%E7%94%A8Hexo-Github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/">使用Hexo + Github搭建博客</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-在-github-上创建项目"><a href="#1-在-github-上创建项目" class="headerlink" title="1. 在 github 上创建项目"></a>1. 在 github 上创建项目</h3><ul>
<li>在 github 上创建一个仓库 liyuan-meng.github.io(用户名.github.io)</li>
<li>在搭建好的项目页点击 settings-GitHub Pages，你会发现项目已经部署到网络上： Your site is published at <a href="https://liyuan-meng.github.io/" target="_blank" rel="noopener">https://liyuan-meng.github.io/</a></li>
</ul>
<h3 id="2-本地安装-Hexo-并更新配置"><a href="#2-本地安装-Hexo-并更新配置" class="headerlink" title="2. 本地安装 Hexo 并更新配置"></a>2. 本地安装 Hexo 并更新配置</h3><ul>
<li><p>安装 Hexo</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo -g</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查 Hexo 是否安装成功</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo -v</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个文件夹用来写博客</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir blog</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入到 blog 目录下，初始化该文件夹，看到后面的“Start blogging with Hexo！”表示初始化成功！</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装依赖</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动 hexo 服务并访问 localhost:4000</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="3-关联-Github-和-Hexo"><a href="#3-关联-Github-和-Hexo" class="headerlink" title="3. 关联 Github 和 Hexo"></a>3. 关联 Github 和 Hexo</h3><ul>
<li><p>设置 github 的 username 和 email(如果之前设置过则跳过此步骤)</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name "liyuan-meng"</span><br><span class="line"></span><br><span class="line">git config --global user.email "****@163.com"</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入到 .ssh 目录下</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.ssh</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成秘钥和公钥（一路回车即可），得到两个文件: id_rsa、id_rsa.pub</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C "****@163.com"</span><br></pre></td></tr></table></figure>
</li>
<li><p>将秘钥添加到 ssh-agent</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
</li>
<li><p>登录 github，点击头像下的 settings，选择 SSH and GPG keys，添加一个 ssh key，然后将公钥 id_rsa.pub 文件中的内容复制进去</p>
</li>
<li><p>测试 ssh key 是否添加成功</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 deploy，打开 blog/_config.yml 文件，修改 deploy</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: git@github.com:liyuan-meng/liyuan-meng.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="4-创建博客并提交"><a href="#4-创建博客并提交" class="headerlink" title="4. 创建博客并提交"></a>4. 创建博客并提交</h3><ul>
<li><p>安装扩展</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 _posts 目录下创建一个 markdown 文件</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new 'hello,hexo'</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成以及部署</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo d -g</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>另一种写法</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>

<p>访问 <a href="http://liyuan-meng.github.io" target="_blank" rel="noopener">http://liyuan-meng.github.io</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/05/25/%E4%BD%BF%E7%94%A8Hexo-Github%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2/" data-id="ckam67qn10004v8xnfayd5zpn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/GridManager/" rel="tag">GridManager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux-%E4%B8%BA%E7%9F%A5%E7%AC%94%E8%AE%B0/" rel="tag">Linux 为知笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/GridManager/" style="font-size: 10px;">GridManager</a> <a href="/tags/Linux-%E4%B8%BA%E7%9F%A5%E7%AC%94%E8%AE%B0/" style="font-size: 10px;">Linux 为知笔记</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/08/30/Socket.io/client/3.%20Connection%20lifecycle/">Socket.io/client/3. Connection lifecycle</a>
          </li>
        
          <li>
            <a href="/2020/08/30/Socket.io/client/2.%20Initialization/">Socket.io/client/2. Initialization</a>
          </li>
        
          <li>
            <a href="/2020/08/30/Socket.io/client/1.%20Installation/">Socket.io/client/1. Installation</a>
          </li>
        
          <li>
            <a href="/2020/08/30/Socket.io/server/5.%20Using%20multiple%20nodes/">Socket.io/server/5. Using multiple nodes</a>
          </li>
        
          <li>
            <a href="/2020/08/30/Socket.io/server/4.%20Rooms/">Socket.io/server/4. Rooms</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>